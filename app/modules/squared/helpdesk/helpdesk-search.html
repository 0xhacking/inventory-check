<div class="helpdesk-search centered" tabindex="0" ng-keyup="helpdeskCtrl.keyPressHandler($event)">

  <h1 translate="helpdesk.helpdesk"></h1>

  <div class="typeahead-large" style="text-align: left;">
    <form>
      <input id="searchInput" type="text"
             tabindex="1"
             placeholder=""
             ng-model="helpdeskCtrl.searchString"
             autofocus="true"/>

      <button type="submit" tabindex="-1" class="btn btn--circle btn--primary icon icon-search"
              ng-click="helpdeskCtrl.search()" ng-disabled="helpdeskCtrl.searchString == ''"></button>
    </form>

    <div class="input-description">
      <p>
        <span translate="helpdesk.searchInputDescription"></span>
        <a href popover="{{'helpdesk.searchInfo' | translate}}"
           popover-placement="bottom" tabindex="-1">
          <span translate="helpdesk.searchCriteriaLink"></span>
        </a>
      </p>

      <div ng-if="helpdeskCtrl.currentSearch.orgFilter" class="helpdesk-tile">
        <span translate="helpdesk.searchingOrg"
              translate-value-name="{{helpdeskCtrl.currentSearch.orgFilter.displayName}}"></span>
        <i class="icon icon-close pointer" ng-click="helpdeskCtrl.initSearchWithoutOrgFilter()"></i>
      </div>
    </div>
  </div>

  <div class="row full">
    <div class="large-offset-2 medium-12 xlarge-10 xxlarge-8 centered columns no-top-margin search-results">
      <div class="medium-6 large-4 columns"
           ng-if="helpdeskCtrl.searchingForUsers || helpdeskCtrl.currentSearch.userSearchResults || helpdeskCtrl.currentSearch.userSearchFailure">
        <h4 translate="helpdesk.users"></h4>

        <div ng-if="helpdeskCtrl.searchingForUsers">
          <span><i class="icon icon-spinner icon-2x"></i></span>

          <p translate="helpdesk.searchingPleaseWait"></p>
        </div>
        <div ng-if="helpdeskCtrl.currentSearch.userSearchFailure">
          <p>{{helpdeskCtrl.currentSearch.userSearchFailure}}</p>
        </div>
        <div
          ng-if="!helpdeskCtrl.searchingForUsers && helpdeskCtrl.currentSearch.userSearchResults.length == 0">
          <p translate="helpdesk.noSearchHits"></p>
        </div>

        <div ng-if="helpdeskCtrl.currentSearch.userSearchResults.length > 0">
          <cs-card class="full pointer"
                   ng-repeat="user in helpdeskCtrl.currentSearch.userSearchResults | limitTo:helpdeskCtrl.currentSearch.userLimit" id="user-card-{{$index}}" >
            <article tabindex="{{$index * 10 + 1}}"
                     ui-sref="helpdesk.user({user:user, id:user.id, orgId:user.organization.id})">
              <header>
                <h5>{{user.displayName}}</h5>
              </header>
              <section>
                <div><span>{{user.userName}}</span></div>
                <div ng-repeat="number in user.phoneNumbers">
                  <span>{{number.value}} ({{'helpdesk.' + number.type | translate}})</span>
                </div>
                <div ng-if="user.organization.displayName" class="right">
                  <span class="belongs-to-org">{{user.organization.displayName}}</span>
                </div>
              </section>
            </article>
          </cs-card>
        </div>

        <div ng-if="helpdeskCtrl.currentSearch.userSearchResults.length > helpdeskCtrl.currentSearch.userLimit"
             class="show-more-results">
          <span><a href ng-click="helpdeskCtrl.showMoreResults('user')" translate="helpdesk.showMore"></a></span>
        </div>

      </div>

      <div class="medium-6 large-4 columns end"
           ng-if="helpdeskCtrl.searchingForOrgs || helpdeskCtrl.currentSearch.orgSearchResults || helpdeskCtrl.currentSearch.orgSearchFailure">

        <h4 translate="helpdesk.customers"></h4>

        <div ng-if="helpdeskCtrl.searchingForOrgs">
          <span><i class="icon icon-spinner icon-2x"></i></span>

          <p translate="helpdesk.searchingPleaseWait"></p>
        </div>
        <div ng-if="helpdeskCtrl.currentSearch.orgSearchFailure">
          <p>{{helpdeskCtrl.currentSearch.orgSearchFailure}}</p>
        </div>
        <div
          ng-if="!helpdeskCtrl.searchingForOrgs && helpdeskCtrl.currentSearch.orgSearchResults.length == 0">
          <p translate="helpdesk.noSearchHits"></p>
        </div>

        <div ng-if="helpdeskCtrl.currentSearch.orgSearchResults.length > 0">
          <cs-card class="full pointer"
                   ng-repeat="org in helpdeskCtrl.currentSearch.orgSearchResults | limitTo:helpdeskCtrl.currentSearch.orgLimit">
            <article tabindex="{{$index * 10 + 2}}" ui-sref="helpdesk.org({org:org, id:org.id})">
              <header>
                <h5>
                  {{org.displayName}}
                  <a tabindex="-1" href class="right" ng-click="helpdeskCtrl.initSearchWithOrgFilter(org)" name="{{org}}"><i
                    class="icon icon-search"></i></a>
                </h5>
              </header>
              <section>
              </section>
              <section class="clickable-area" ui-sref="helpdesk.org({org:org, id:org.id})"></section>
            </article>
          </cs-card>
        </div>

        <div ng-if="helpdeskCtrl.currentSearch.orgSearchResults.length > helpdeskCtrl.currentSearch.orgLimit"
             class="show-more-results">
          <span><a href ng-click="helpdeskCtrl.showMoreResults('org')" translate="helpdesk.showMore"></a></span>
        </div>

      </div>

      <div class="medium-6 large-4 columns end"
           ng-if="helpdeskCtrl.currentSearch.orgFilter && (helpdeskCtrl.searchingForDevices || helpdeskCtrl.currentSearch.deviceSearchResults || helpdeskCtrl.currentSearch.deviceSearchFailure)">
        <h4 translate="helpdesk.devices"></h4>

        <div ng-if="helpdeskCtrl.searchingForDevices">
          <span><i class="icon icon-spinner icon-2x"></i></span>

          <p translate="helpdesk.searchingPleaseWait"></p>
        </div>

        <div ng-if="helpdeskCtrl.currentSearch.deviceSearchFailure">
          <p>{{helpdeskCtrl.currentSearch.deviceSearchFailure}}</p>
        </div>

        <div
          ng-if="!helpdeskCtrl.searchingForDevices && helpdeskCtrl.currentSearch.deviceSearchResults.length == 0">
          <p translate="helpdesk.noSearchHits"></p>
        </div>

        <div ng-if="helpdeskCtrl.currentSearch.deviceSearchResults.length > 0">
          <cs-card class="full pointer"
                   ng-repeat="device in helpdeskCtrl.currentSearch.deviceSearchResults | limitTo:helpdeskCtrl.currentSearch.deviceLimit">
            <article tabindex="{{$index * 10 + 3}}"
                     ui-sref="helpdesk.device({device:device, id:device.id, orgId:helpdeskCtrl.currentSearch.orgFilter.id})">
              <header>
                <h5>{{device.displayName}}</h5>
              </header>
              <section>
                <div ng-if="device.product"><span>{{device.product}}</span></div>
                <div ng-if="device.serial"><span>{{device.serial}}</span></div>
                <div ng-if="device.mac"><span>{{device.mac}}</span></div>
                <div ng-if="device.organization.displayName" class="right">
                  <span class="belongs-to-org">{{device.organization.displayName}}</span>
                </div>
              </section>
            </article>
          </cs-card>
        </div>

        <div ng-if="helpdeskCtrl.currentSearch.deviceSearchResults.length > helpdeskCtrl.currentSearch.deviceLimit"
             class="show-more-results">
          <span><a href ng-click="helpdeskCtrl.showMoreResults('device')" translate="helpdesk.showMore"></a></span>
        </div>

      </div>

    </div>
  </div>
</div>
