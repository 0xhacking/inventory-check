<!-- BEGIN CI Sync -->
<div class="container-ci-sync">

  <div class="page-header row full">
    <div class="page-title">
      <h2 class="title" translate="messengerCiSync.pageTitle"></h2>
    </div>
  </div>

  <div class="content">
    <!-- BEGIN CONTENT -->

    <cs-tabset>

      <cs-tab>
        <cs-tab-heading translate="messengerCiSync.syncStatusHeading"></cs-tab-heading>
        <div>
          <!-- BEGIN TAB CONTENT -->

          <div class="panel panel-primary">
            <div class="panel-heading">
              <h3 class="panel-title" translate="messengerCiSync.syncStatusHeading"></h3>

            </div>
            <div class="panel-body">
              <!-- BEGIN PANEL CONTENT -->

              <div>
                <div ng-if="sync.dev">
                  <p>[DEBUG] Viewing as {{sync.adminType.label}}</p>
                  <div class="btn-group">
                    <button type="button" ng-click="sync.setOrgAdmin()" ng-disabled="sync.adminTypes.org === sync.adminType" class="btn btn-primary">{{sync.adminTypes.org.label}}</button>
                    <button type="button" ng-click="sync.setOpsAdmin()" ng-disabled="sync.adminTypes.ops === sync.adminType" class="btn btn-primary">{{sync.adminTypes.ops.label}}</button>
                  </div>
                </div>

                <div class="col-md-4 sync-stats">
                    <h3 translate="messengerCiSync.syncStatusHeading"></h3> <span class="bottom-padding icon icon-refresh" ng-click="sync.refreshStatus()" tooltip="{{sync.refresh}}"></span>

                    <formly-form model="sync.syncInfo" fields="sync.fields">
                    </formly-form>

                    <p tooltip-placement="top" tooltip="{{sync.syncStatusTooltip}}" translate="messengerCiSync.syncStatusHeading"></p>
                    <!-- Ugly, but it seems the only way that works so far. Would be nice to find simpler way -->
                    <cs-toggle-switch ng-if="sync.adminTypes.ops !== sync.adminType" ng-model="sync.syncInfo.isSyncEnabled" toggle-id="toggleIsSyncing" name="toggleSyncing" class="no-click" is-disabled="true" size="small"></cs-toggle-switch>
                    <cs-toggle-switch ng-if="sync.adminTypes.ops === sync.adminType" ng-model="sync.syncInfo.isSyncEnabled" toggle-id="toggleIsSyncing" name="toggleSyncing" size="small"></cs-toggle-switch>

                    <p tooltip-placement="bottom" tooltip="{{sync.authRedirectTooltip}}" translate="messengerCiSync.authRedirectHeading"></p>
                    <!-- Ugly, but it seems the only way that works so far. Would be nice to find simpler way -->
                    <cs-toggle-switch ng-if="sync.adminTypes.ops !== sync.adminType"  ng-model="sync.syncInfo.isAuthRedirect" toggle-id="toggleAuthRedirect" name="toggleAuth" class="no-click" is-disabled="true" size="small"></cs-toggle-switch>
                    <cs-toggle-switch ng-if="sync.adminTypes.ops === sync.adminType"  ng-model="sync.syncInfo.isAuthRedirect" toggle-id="toggleAuthRedirect" name="toggleAuth" size="small"></cs-toggle-switch>
                    <input class="button warning" type="submit" value="{{sync.patchSyncButtonText}}" ng-if="sync.adminTypes.ops === sync.adminType" ng-click="sync.patchSync()">
                    <a class="button" ng-if="!sync.isDirSync()" href="https://wapibts.webexconnect.com/wbxconnect/acs/widgetserver/mashkit/apps/standalone.html?app=WBX.base.orgadmin" target="_blank" role="button" translate="messengerCiSync.orgAdminButtonText"></a>
                </div>
              </div>

              <!-- END PANEL CONTENT -->
            </div>
          </div>

          <!-- END TAB CONTENT -->
        </div>
      </cs-tab>

      <cs-tab ng-if="sync.dev">
        <cs-tab-heading>Debug</cs-tab-heading>
        <div>
          <!-- BEGIN TAB CONTENT -->

          <div class="info">

            <span class="info-header">Info from CI</span>

            <ul>
              <li class="data-item" ng-repeat="entry in sync.ciData"><span class="data-key">{{entry.key}}:</span> {{entry.value}}</li>
            </ul>

            <div class="sub-info indented">
              <span class="info-header">Admins</span>

              <div ng-repeat="admin in sync.ciAdmins">
                <ul>
                  <li class="data-item" ng-repeat="(key, value) in admin"><span class="data-key">{{key}}:</span> {{value}}</li>
                </ul>
              </div>
            </div>

            <div class="sub-info indented">
              <span class="info-header">Users</span>

              <div ng-repeat="user in sync.ciUsers">
                <ul>
                  <li class="data-item" ng-repeat="(key, value) in user"><span class="data-key">{{key}}:</span> {{value}}</li>
                </ul>
              </div>
            </div>
          </div>



          <div class="info">
            <span class="info-header">Info from WAPI (URDB)</span> <button class="btn btn-default" ng-click="sync.refreshOrgInfo()">Refresh</button>

            <ul>
              <li class="data-item" ng-repeat="entry in sync.org.info.orgInfo"><span class="data-key">{{entry.key}}:</span> {{entry.value}}</li>
            </ul>

            <div class="sub-info indented">
              <span class="info-header">General Info</span>

              <div>
                <ul>
                  <li class="data-item" ng-repeat="entry in sync.org.info.generalInfo"><span class="data-key">{{entry.key}}:</span> {{entry.value}}</li>
                </ul>
              </div>
            </div>

            <div class="sub-info indented">
              <span class="info-header">Policies</span>

              <div>
                <ul>
                  <li class="data-item" ng-repeat="policy in sync.org.info.policies"><span class="data-key">{{policy.key}}:</span> {{policy.value}}</li>
                </ul>
              </div>
            </div>

            <div class="sub-info indented">
              <span class="info-header">Ext</span>

              <div>
                <ul>
                  <li class="data-item" ng-repeat="entry in sync.org.info.ext"><span class="data-key">{{entry.key}}:</span> {{entry.value}}</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- END TAB CONTENT -->
        </div>
      </cs-tab>

    </cs-tabset>

    <!-- END CONTENT -->
  </div>

</div>
<!-- END CI Sync -->
