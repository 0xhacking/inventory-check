<cs-page-header title="hge.title"></cs-page-header>
<script type="text/ng-template" id="userTemplate.html">
  <div>
    <span bind-html-unsafe="match.label.userName | typeaheadHighlight:query"></span>
  </div>
  <a ng-repeat="number in match.label.userNumber">
    <span bind-html-unsafe="number | typeaheadHighlight:query"></span>
  </a>
</script>
<div class="hg-edit">
  <div class="save-section clearfix" ng-if="hge.form.$dirty">
    <p class="left">{{:: 'huronHuntGroup.saveLabel' | translate}}</p>
    <div class="right">
      <button ng-click="hge.resetForm()">{{:: 'usersPage.cancel' | translate}}</button>
      <button class="secondary" cs-btn loading="hge.saveInProgress" ng-click="hge.saveForm()" ng-disabled="hge.form.$invalid">{{:: 'usersPage.save' | translate}}</button>
    </div>
  </div>
  <div ng-if="!hge.initialized">
    Loading...
  </div>
  <div class="row" ng-if="hge.initialized">
    <div class="medium-6 columns">
      <form novalidate>
        <formly-form model="hge.model" fields="hge.fields" form="hge.form"></formly-form>
      </form>
      <div class="hg-wrapper">
        <label for="fallback-dest">{{:: 'huronHuntGroup.fallbackLabel' | translate}}</label>
        <p>{{:: 'huronHuntGroup.fallbackDesc' | translate}}</p>
        <div ng-if="hge.addFallback" class="form-input">
          <input type="text" ng-model="hge.userSelected" typeahead="user for user in hge.userData | filter:$viewValue | limitTo: 10" typeahead-template-url="userTemplate.html" typeahead-on-select="hge.selectHuntGroupUser($item)" placeholder="{{:: 'huronHuntGroup.numberLabel' | translate}}">
        </div>
        <div ng-if="!hge.addFallback">
          <div class="clearfix">
            <div class="small header-background primary cs-card">
              <article>
                <header ng-click="hge.toggleFallback()">
                  <div class="header-with-right-icon">
                    <h5 class="ellipsis">{{hge.model.fallbackDestination.userName}}</h5>
                    <i class="icon icon-chevron-down"></i>
                  </div>
                </header>
                <section ng-if="hge.model.fallbackDestination.open">
                  <p>{{hge.model.fallbackDestination.email}}
                    <cs-radiolist options="hge.model.fallbackDestination.numbers" ng-model="hge.model.fallbackDestination.number"></cs-radiolist></p>
                </section>
                <footer ng-if="hge.model.fallbackDestination.open">
                  <a ng-click="hge.removeFallbackDest()" href="">{{:: 'huronHuntGroup.remove' | translate}}</a>
                </footer>
              </article>
            </div>
          </div>
          <cs-checkbox ckid="ckbox1" ng-model="cb.checkboxValue0" label="{{:: 'huronHuntGroup.voiceCheckLabel' | translate}}"></cs-checkbox>
        </div>
      </div>
    </div>
    <div class="medium-6 columns">
      <div class="hg-wrapper">
        <label for="fallback-dest">{{:: 'huronHuntGroup.methodLabel' | translate}}</label>
        <p>{{:: 'huronHuntGroup.methodDesc' | translate}}</p>
        <ul class="hgmethods">
          <li class="hgmethod" ng-class="{current: hge.model.huntMethod === 'longest-idle'}">
            <a href="#" ng-click="hge.selectHuntMethod('longest-idle')"><i class="icon icon-circle-clock-hands"></i>
              <div>Longest Idle</div>
            </a>
          </li>
          <li class="hgmethod" ng-class="{current: hge.model.huntMethod === 'broadcast'}">
            <a href="#" ng-click="hge.selectHuntMethod('broadcast')"><i class="icon icon-circle-arrows-cross"></i>
              <div>Broadcast</div>
            </a>
          </li>
          <li class="hgmethod" ng-class="{current: hge.model.huntMethod === 'circular'}">
            <a href="#" ng-click="hge.selectHuntMethod('circular')"><i class="icon icon-circle-arrows-circular"></i>
              <div>Circular</div>
            </a>
          </li>
          <li class="hgmethod" ng-class="{current: hge.model.huntMethod === 'top-down'}">
            <a href="#" ng-click="hge.selectHuntMethod('top-down')"><i class="icon icon-circle-arrow-down"></i>
              <div>Top Down</div>
            </a>
          </li>
        </ul>
        <div class="hgmembers">
          <div class="form-input">
            <label for="">{{:: 'huronHuntGroup.membersLabel' | translate}}</label>
            <input type="text" ng-model="hge.member" typeahead="user for user in hge.userData | filter:$viewValue | limitTo: 10" typeahead-template-url="userTemplate.html" typeahead-on-select="hge.selectHuntGroupMember($item)" placeholder="{{:: 'huronHuntGroup.addMemberLabel' | translate}}">
          </div>
          <p>{{:: 'huronHuntGroup.membersDesc' | translate}}</p>
          <div drop-list="hge.model.members" callback="hge.callback()" unique="userName">
            <div ng-repeat="item in hge.model.members" drag-drop draggable="item" class="clearfix hgmember">
              <div class="small header-background primary cs-card" class="large header-background primary">
                <article>
                  <header ng-click="hge.toggleMembers(item)">
                    <div class="header-with-right-icon">
                      <h5 class="ellipsis">{{item.userName}}</h5>
                      <i class="icon icon-chevron-down"></i>
                    </div>
                  </header>
                </article>
                <section ng-if="item.open">
                  <p> {{item.email}}
                    <cs-radiolist options="item.numbers" ng-model="item.number"></cs-radiolist>
                    <a href="" ng-click="hge.removeHuntMember(item)">{{:: 'huronHuntGroup.removeMem' | translate}}</a>
                  </p>         
                </section>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
